---
published: true
title:  "ë”°ë¼í•˜ë©° ë°°ìš°ëŠ” C++ Section 15. ì˜ë¯¸ë¡ ì  ì´ë™ê³¼ ìŠ¤ë§ˆíŠ¸ í¬ì¸í„°"
excerpt: ""

categories:
  - ë”°ë°°ì”¨++
tags:
  - [C++]

toc: true
toc_sticky: true
 
date: 2022-05-01
last_modified_at: 2022-05-01
---

# ğŸ¤” í•™ìŠµëª©í‘œ
- ë”°ë¼í•˜ë©° ë°°ìš°ëŠ” C++ Section 15. ì˜ë¯¸ë¡ ì  ì´ë™ê³¼ ìŠ¤ë§ˆíŠ¸ í¬ì¸í„°

# ğŸ“ƒ í•™ìŠµë‚´ìš©
## ğŸ“ **ë”°ë¼í•˜ë©° ë°°ìš°ëŠ” C++ Section 15. ì˜ë¯¸ë¡ ì  ì´ë™ê³¼ ìŠ¤ë§ˆíŠ¸ í¬ì¸í„°**

### **ğŸŒ± 15.1 ì´ë™ì˜ ì˜ë¯¸ì™€ ìŠ¤ë§ˆíŠ¸ í¬ì¸í„°**

- move semantics
- Smart pointers

```cpp
#include <iostream>

using namespace std;

class Resource
{
public:
	int m_data[100];

public:
	Resource()
	{
		cout << "Resource constructed" << endl;
	}

	~Resource()
	{
		cout << "Resource destroyed" << endl;
	}
};

void doSomething()
{
	try
	{
		Resource* res = new Resource;

		if (true)
		{
			throw - 1; // exception
		}
		delete res;
	}
	catch (...)
	{
	}
	return;
}

int main()
{
	doSomething();
}
```

- new í•œê³³ì—ì„œ delete í•´ì£¼ëŠ”ê²ƒì„ RAII ë¼ê³ í•¨
  - RAII: resource acquisition is initialization
- early return
  - deleteí•˜ê¸°ì „ íŠ¹ì •ì¡°ê±´ì´ ì¶©ì¡±ë˜ì–´ returní•´ë²„ë¦¬ëŠ”ê²ƒ
  - ì „í†µì ì¸ c++ì—ì„  ì´ëŸ°ì‹ìœ¼ë¡œ í•´ì£¼ë„ë¡ ë˜ì–´ìˆì—ˆìŒ

___


**std::auto_ptr<int>;** 

- c++ 98 ë§Œë“¤ì–´ì§ c++ 11ë•Œ ì‚¬ìš©í•˜ì§€ ì•Šê¸°ë¡œí–ˆê³  c++ 17ë•Œ ì‚­ì œê°€ë¨ 
- ë³µì¡í•œê²½ìš° ì‘ë™í•˜ì§€ ì•ŠëŠ”ê²½ìš°ê°€ ìˆì—ˆìŒ
- ìŠ¤ë§ˆíŠ¸í¬ì¸í„°ë¡œ ë„˜ì–´ê°€ê²Œë¨
- ì†Œë©¸ìì—ì„œ ë³€ìˆ˜ê°€ nullptrì´ ì•„ë‹ˆë©´ ì§€ìš°ëŠ” ê¸°ëŠ¥ì„
- í´ë˜ìŠ¤ë‹¨ìœ„ë¡œ ë¬¶ìœ¼ë©´ 

```cpp
class Resource
{
public:
	int m_data[100];

public:
	Resource()
	{
		cout << "Resource constructed" << endl;
	}

	~Resource()
	{
		cout << "Resource destroyed" << endl;
	}
};

template<typename T>
class AutoPtr
{
public:
	T* m_ptr = nullptr;

public:
	AutoPtr(T* ptr = nullptr)
		:m_ptr(ptr) {}
	~AutoPtr() 
	{
		if (m_ptr != nullptr) delete m_ptr; 
	}
	T& operator *() const { return *m_ptr; }  
	T* operator ->() const { return m_ptr; } 
	bool inNull() const { return m_ptr == nullptr; }
};
```

```cpp
void doSomething()
{
	try 
	{
		AutoPtr<Resource> res = new Resource;  
		if (true)
		{
			throw - 1; 
		}		

	}
	catch (...)
	{
	}
	return;		
}

int main()
{
	doSomething();
}
```

- **dull pointer:** ë™ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹ë°›ê³ ìˆì§€ë§Œ ìê¸°ê°€ëê¹Œì§€ ì±…ì„ì„ ì•ˆì§€ê³  ìˆ˜ë™ìœ¼ë¡œí•´ì¤˜ì•¼í•˜ëŠ” í¬ì¸í„°
- **smart pointer:** `AutoPtr<Resource> res = new Resource;` 
  - ê°ì²´ res ê°€ ì†Œë©¸ë  ë•Œ AutoPtr í´ë˜ìŠ¤ì˜ ì†Œë©¸ìì—ì„œ ì•Œì•„ì„œ delete í•´ì¤Œ
  - `AutoPtr<Resource> res(new Resource);` ì´ˆê¸°í™” í•´ì£¼ëŠ”ê²ƒì´ê¸° ë•Œë¬¸ì— ì´ë ‡ê²Œ í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ìŒ

___

**ë¬¸ì œ ë°œìƒ ì½”ë“œ**

```cpp
int main()
{
	{]
    // int i; int *ptr(&i); int *ptr2 = nullptr; ê³¼ ê°™ì€ í˜•íƒœ
		AutoPtr<Resource> res1(new Resource); // ì´ˆê¸°í™” ëœ ìƒíƒœ
		AutoPtr<Resource> res2; // ì´ˆê¸°í™”ì•ˆë¨ nullptr

		cout << res1.m_ptr << endl; 
		cout << res2.m_ptr << endl; 

		res2 = res1;	// ë¬¸ì œ ë°œìƒ ë¶€ë¶„

		cout << res1.m_ptr << endl;  
		cout << res2.m_ptr << endl;  
	}
}
```

```cpp
ì¶œë ¥ ê²°ê³¼
Resource constructed
0014FFA8
00000000
0014FFA8
0014FFA8
Resource destroyed
Resource destroyed
```

- ëŸ°íƒ€ì„ ì—ëŸ¬ ë°œìƒë¨
  - ì´ë¯¸ ì§€ì›Œì§„ ê°ì²´ë¥¼ ë˜ ì§€ìš°ë ¤í•˜ì—¬ ì—ëŸ¬ ë°œìƒ
- `res2 = res1;` ë‚´ë¶€ì ìœ¼ë¡œ AutoPtrì•ˆì— ìˆëŠ” ë©¤ë²„ë¥¼ ë³µì‚¬í•´ì¤Œ
- `new Resource` ì— ëŒ€í•œ ì†Œìœ ê¶Œì„ `res2 = res1;` í•˜ê²Œë˜ëŠ” ìˆœê°„ res1ì˜ ì†Œìœ ê¶Œì„ res2 ì— ë„˜ê²¨ì£¼ê²Œ ë˜ì–´ ë‘ë³€ìˆ˜ê°€ ëª¨ë‘ ì†Œìœ ê¶Œì„ ê°–ê²Œë˜ì–´ ë¬¸ì œê°€ë¨


**í•´ê²° ë°©ë²•**

```cpp
#include <iostream>
using namespace std;

template<typename T>
class AutoPtr
{
public:
	T* m_ptr= nullptr;

public:
	AutoPtr(T* ptr = nullptr)
		:m_ptr(ptr) {}
	~AutoPtr()
	{
		if(m_ptr != nullptr) delete m_ptr;
	}

	AutoPtr(AutoPtr& a)  // ë³µì‚¬ ìƒì„±ì
	{
		m_ptr = a.m_ptr;
		a.m_ptr = nullptr;  // ì†Œìœ ê¶Œ ë°•íƒˆ
	}

	AutoPtr& operator = (AutoPtr& a)  // ëŒ€ì… ì—°ì‚°ì ì˜¤ë²„ë¡œë”©
	{
		if (&a == this)  
			return *this;
		
		delete m_ptr;   
		m_ptr = a.m_ptr; 
		a.m_ptr = nullptr;   
		return *this;
	}

	T& operator *() const { return *m_ptr; }
	T* operator ->() const { return m_ptr; }
	bool inNull() const { return m_ptr == nullptr; }
};
```
```cpp
ì¶œë ¥ê²°ê³¼
Resource constructed
000001F0E8063820
0000000000000000
0000000000000000
000001F0E8063820
Resource destroyed // res2.m_ptr ì˜ ì†Œë©¸ìì—ì„œ ì‹¤í–‰ì‹œí‚´
```

- ë³µì‚¬ ìƒì„±ìì—ì„œ íŒŒë¼ë©”íƒ€ì˜ ptrë¥¼ ë³µì‚¬í•´ì„œ m_ptrì— ë„£ê³  íŒŒë¼ë©”íƒ€ì˜ nullptrì„ ë„£ì–´ ì†Œìœ ê¶Œì„ ë°•íƒˆí•´ì£¼ëŠ” ë°©ì‹

- ëŒ€ì… ì—°ì‚°ì ì˜¤ë²„ë¡œë”©ì—ì„œëŠ” ì´ë¯¸ ë‚´ê°€ ê°–ê³  ìˆë˜ê±´ ì§€ì›Œë²„ë¦¬ê³  ìƒˆë¡œ ë“¤ì–´ì˜¨ì–˜ì˜ ë©”ëª¨ë¦¬ ì£¼ì†Œë¥¼ ë³µì‚¬í•´ì„œ ë°›ê³  ì›ë˜ ë©”ëª¨ë¦¬ ì£¼ì†ŒëŠ” nullptrë¡œ ë°”ê¿”ë²„ë¦¬ë©´ ì†Œìœ ê¶Œì´ ì´ì „ì´ ë¨

- **Move semantics:** ì†Œìœ ê¶Œì„ ì´ì „ ì‹œí‚¤ëŠ” ë°©ì‹

___

**syntax vs semantics**

- syntax
  - ë¬¸ë²•ì— ë§ëƒ ì•ˆë§ëƒ, ì»´íŒŒì¼ì´ ë˜ëƒ ì•ˆë˜ëƒë¥¼ ë³´ëŠ” ê²ƒ
- semantics
  - ì»´íŒŒì¼ì´ ë˜ëŠ”ê±´ ë˜‘ê°™ì€ë° ì‹¤ì§ˆì ìœ¼ë¡œ ë‚´ë¶€ì˜ ì˜ë¯¸ê°€ ë§ëŠ”ì§€ ë³´ëŠ”ê²ƒ

```cpp
int x = 1, y = 1;
x + y;

string str1("Hello"), str2("World");
str1 + str2; // append
```

- ìœ„ `+` ì˜ ê¸°í˜¸ëŠ” ê°™ì§€ë§Œ ì˜ë¯¸ê°€ ë‹¤ë¦„ ì´ë¥¼ semanticsë¼ê³  í•¨

- value semantics (copy semantics)
- reference semantice (pointer)
- move semantics (move)

### **ğŸŒ± 15.2 ì˜¤ë¥¸ìª½-ê°’ ì°¸ì¡°**

- R-value References

```cpp
#include <iostream>
using namespace std;

void doSomething(int& lref) { cout << "L-value ref" << endl; }
void doSomething(int&& rref) { cout << "R-value ref" << endl; }
int getResult() { return 100; }

int main()
{
	int x = 5;             
	int y = getResult();     
	const int cx = 6;          
	const int cy = getResult(); 

	/* L-value references */
	int& lr1 = x;		            
	int& lr2 = cx;		        
	int& lr3 = 10;			      

	const int& lr4 = x;		
	const int& lr5 = cx;
	const int& lr6 = 10;	

	/* R-value references */
	int&& rr1 = x;		
	int&& rr2 = cx;		
	int&& rr3 = 10;		
	int&& rr4 = getResult();
	rr3 = 20;			

	const int&& rr5 = x;	
	const int&& rr6 = cx;
	const int&& rr7 = 10;
	const int&& rr8 = getResult();

	doSomething(x);				/* L-value reference */
	doSomething(10);			/* R-value reference */
	doSomething(getResult());	/* R-value reference */
	doSomething(rr3);			/* L-value reference */
}
```

**variable**
-	`int x = 5;`                     
    - 5ë¼ëŠ” R-valueë¥¼ L-value ì¸ x ë³€ìˆ˜ì˜ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ëŠ”ê²ƒ
-	`int y = getResult();`          
    - í•¨ìˆ˜ì˜ ë¦¬í„´ê°’ R-valueë¥¼ L-value ì¸ y ë³€ìˆ˜ì˜ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ëŠ”ê²ƒ
-	`const int cx = 6;`             
    - 6ë¼ëŠ” R-valueë¥¼ L-value ì¸ cx const ë³€ìˆ˜ì˜ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ëŠ”ê²ƒ
-	`const int cy = getResult();`   
    - í•¨ìˆ˜ì˜ ë¦¬í„´ê°’ R-valueë¥¼ L-value ì¸ cy const ë³€ìˆ˜ì˜ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ëŠ”ê²ƒ

**L-value references**

- `int& lr1 = x;`
  - ì»´íŒŒì¼ â­•
  - Modifiable L-vlaue lr1ê³¼ xëŠ” ê°™ì€ ì£¼ì†Œë¥¼ ê°€ì§

- `int& lr2 = cx;`		            
  - ì»´íŒŒì¼ âŒ
  - Non-modifiable L-vlaue lr2ê°€ constê°€ ì•„ë‹ˆë¯€ë¡œ cxë¥¼ ë„£ì„ìˆ˜ ì—†ìŒ

- `int& lr3 = 10;`			  
  - ì»´íŒŒì¼ âŒ         
  -  R-value lr3ê°€ ì´í›„ ì‚¬ìš©ë ë•Œ ìê¸°ê°€ ì°¸ì¡°í•˜ê³ ìˆëŠ” ë³€ìˆ˜ê°€ ë©”ëª¨ë¦¬ë¥¼ ê°–ê³ ìˆë‹¤ëŠ” ì „ì œí•˜ì— ì‘ë™í•˜ê¸°ë•Œë¬¸ì— L-value references ì´ê¸°ë•Œë¬¸ì— R-valueì— ëŒ€í•´ì„œëŠ” referencesë¥¼ ê°€ì§ˆìˆ˜ ì—†ìŒ
  - ê³ ì „ì  C++ ì—ì„  referencesë¥¼ L-value referencesë¥¼ ì˜ë¯¸í•¨

- `const int& lr4 = x;`		
  - ì»´íŒŒì¼ â­•
  - Modifiable L-vlaue lr1ê³¼ xëŠ” ê°™ì€ ì£¼ì†Œë¥¼ ê°€ì§
- `const int& lr5 = cx;`
  - ì»´íŒŒì¼ â­•
  - Non-modifiable L-vlaue lr2ê°€ constê°€ ì•„ë‹ˆë¯€ë¡œ cxë¥¼ ë„£ì„ìˆ˜ ì—†ìŒ
- `const int& lr6 = 10;`	
  - ì»´íŒŒì¼ â­• 
  - R-value ë©”ëª¨ë¦¬ì£¼ì†Œì™€ ìƒê´€ì—†ì´ ì‹¬ë³¼ë¦­ ì»¨ìŠ¤í„´ìŠ¤ì²˜ëŸ¼ë§Œ ì‚¬ìš©í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ë¡œ ê°€ëŠ¥í•¨

**R-value references**

- R-value references ëŠ” `&&` ì„ `&` ì™€ êµ¬ë¶„í•˜ê¸° ìœ„í•¨ì„ 
- ê³§ ì‚¬ë¼ì§ˆ ì–˜ë“¤ë§Œ ë‹´ì„ìˆ˜ ìˆìŒ
- R-value ë ˆí¼ëŸ°ìŠ¤ë¡œ ê°€ë¥´ì¼œì§€ëŠ” ì• ë“¤ì€ moveë¥¼ í•´ì„œ ë‹¤ë¥¸ê³³ìœ¼ë¡œ ì˜®ê²¨ë„ ì–´ì§œí”¼ ì‚¬ë¼ì§ˆ ì• ë“¤ì´ë¼ ì•„ë¬´ë„ ì°¾ì§€ì•ŠëŠ”ë‹¤ëŠ” ì˜ë¯¸
- R-valueê°€ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ë‚˜ ì¸ìŠ¤í„´ìŠ¤ë¼ë©´ valueë¡œ Move semantics ë¥¼ í•´ë²„ë ¤ë„ ë¬¸ì œê°€ ì—†ë‹¤ëŠ” ê²ƒì´ê³  ì‚¬ìš©ì„ í• ìˆ˜ë„ ìˆìŒ

<br>

- `int&& rr1 = x;`		
  - ì»´íŒŒì¼ âŒ
  - Modifiable L-vlaue
- `int&& rr2 = cx;`	
  - ì»´íŒŒì¼ âŒ
  - Non-modifiable L-vlaue
- `int&& rr3 = 10;`		
  - ì»´íŒŒì¼ â­•
  - R-value ë§Œ ë°›ì„ìˆ˜ ìˆìŒ
- `int&& rr4 = getResult();`
  - ì»´íŒŒì¼ â­•
  - ë¦¬í„´ë°›ì€ ì„ì‹œì ì¸ê°’ì„ `rr4`ì— ì €ì¥í•´ë†“ëŠ” ê²ƒ
- `rr3 = 20;`			
  - R-valueì˜ ê°’ì„ ë³€ê²½í• ìˆ˜ ìˆìŒ

<br>

- `const int&& rr5 = x;`	
  - ì»´íŒŒì¼ âŒ
  - Modifiable L-vlaue
- `const int&& rr6 = cx;`
  - ì»´íŒŒì¼ âŒ
  - Non-modifiable L-vlaue
- `const int&& rr7 = 10;`
  - ì»´íŒŒì¼ â­•
- `const int&& rr8 = getResult();`
  - ì»´íŒŒì¼ â­•

___

```cpp
void doSomething(int& lref) { cout << "L-value ref" << endl; }
void doSomething(int&& rref) { cout << "R-value ref" << endl; }
int getResult() { return 100; }
```
- ì»´íŒŒì¼ëŸ¬ê°€ íŒŒë¼ë©”íƒ€ê°€ L-value, R-value ë ˆí¼ëŸ°ìŠ¤ì¸ê²ƒì€ ë‹¤ë¥´ê²Œ ê¸°ëŠ¥ì„ í• ìˆ˜ ìˆë„ë¡ ì˜¤ë²„ë¡œë”©ì„ ì¸ì •í•´ì¤Œ

<br>

- `doSomething(x);`			
  - L-value reference 
- `doSomething(10);`			
  - R-value reference 
- `doSomething(getResult());`	
  - R-value reference 
- `doSomething(rr3);`		
  - L-value reference

<br>

- R-Value referenceë¡œ ë°›ì•„ì˜¨ ê²½ìš°ì—ëŠ” íŒŒë¼ë©”íƒ€ê°€ ì–´ì§œí”¼ ë‹¤ë¥¸ë°ì„œ ì“¸ì¼ì´ ì—†ê¸°ë•Œë¬¸ì— Move Semanticë¥¼ ì‚¬ìš©í• ìˆ˜ ìˆìŒ
- L-Value reference ë¥¼ ì‚¬ìš©í•  ê²½ìš°ì—ëŠ” íŒŒë¼ë©”íƒ€ê°€ ë©”ëª¨ë¦¬ë¥¼ ê°–ê³ ìˆëŠ” ë³€ìˆ˜ê³  ê·¸ ë³€ìˆ˜ëŠ” dosomethingí•¨ìˆ˜ ë°–ì—ì„œë„ ì‚¬ìš©ì„ í•´ì•¼í•˜ë‹ˆê¹Œ moveSemanticë¡œ ê°€ì ¸ì™€ë²„ë¦¬ë©´ ë¬¸ì œê°€ ìƒê¸¸ìˆ˜ ìˆìœ¼ë¯€ë¡œ Move Semanticë¥¼ ì‚¬ìš©í• ìˆ˜ ì—†ìŒ

### **ğŸŒ± 15.3 ì´ë™ ìƒì„±ìì™€ ì´ë™ ëŒ€ì…**

### **ğŸŒ± 15.4 std::move**

### **ğŸŒ± **

### **ğŸŒ± **

### **ğŸŒ± **

# ğŸ“Œì°¸ì¡°ë§í¬
ì¸í”„ëŸ° **ë”°ë¼í•˜ë©´ì„œ ë°°ìš°ëŠ” C++** - [https://www.inflearn.com/course/following-c-plus](https://www.inflearn.com/course/following-c-plus)